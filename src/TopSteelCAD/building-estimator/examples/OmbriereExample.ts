/**
 * Exemple d'utilisation de l'Ombri√®re Photovolta√Øque
 * D√©montre la nouvelle architecture extensible
 * Building Estimator - TopSteelCAD
 */

import {
  BuildingFactory,
  BuildingType
} from '../core';
import {
  OmbriereBuilding,
  COMMON_SOLAR_PANELS,
  DEFAULT_OMBRIERE_CONFIG
} from '../types';

/**
 * Exemple 1: Cr√©er une ombri√®re avec configuration par d√©faut
 */
export function createDefaultOmbriere(): OmbriereBuilding {
  console.log('=== EXEMPLE 1: Ombri√®re par d√©faut ===\n');

  const ombriere = BuildingFactory.create<OmbriereBuilding>({
    name: 'Ombri√®re Parking Entreprise',
    type: BuildingType.OMBRIERE,
    dimensions: DEFAULT_OMBRIERE_CONFIG.dimensions,
    solarArray: DEFAULT_OMBRIERE_CONFIG.solarArray,
    location: {
      latitude: 45.75, // Lyon, France
      longitude: 4.85,
      altitude: 200
    }
  });

  // Afficher r√©sultats
  console.log(`‚úÖ Ombri√®re cr√©√©e: ${ombriere.name}`);
  console.log(`üìê Dimensions: ${ombriere.dimensions.length/1000}m x ${ombriere.dimensions.width/1000}m`);
  console.log(`üöó Places de parking: ${ombriere.parkingLayout?.numberOfSpaces}`);
  console.log(`‚òÄÔ∏è Panneaux solaires: ${ombriere.structure.solarPanels.length}`);
  console.log(`‚ö° Puissance install√©e: ${ombriere.electricalDesign.totalPower.toFixed(1)} kWc`);
  console.log(`üîã Production annuelle: ${ombriere.performance?.annualProduction.toFixed(0)} kWh/an`);
  console.log(`üå± √âconomie CO2: ${ombriere.performance?.carbonOffset.toFixed(1)} tonnes/an`);
  console.log(`üèóÔ∏è Poids acier: ${ombriere.structure.posts.reduce((sum, p) => sum + p.weight, 0).toFixed(0)} kg\n`);

  return ombriere;
}

/**
 * Exemple 2: Cr√©er une ombri√®re personnalis√©e
 */
export function createCustomOmbriere(): OmbriereBuilding {
  console.log('=== EXEMPLE 2: Ombri√®re personnalis√©e ===\n');

  // Configuration pour 40 places de parking
  const ombriere = BuildingFactory.create<OmbriereBuilding>({
    name: 'Grande Ombri√®re Centre Commercial',
    type: BuildingType.OMBRIERE,
    dimensions: {
      length: 100000,        // 100m (20 places x 5m)
      width: 25000,          // 25m (5 rang√©es x 5m)
      clearHeight: 2800,     // 2.8m de hauteur libre
      slope: 0,
      tilt: 20,              // 20¬∞ d'inclinaison optimale
      numberOfParkingSpaces: 100,
      parkingSpaceWidth: 2500,
      parkingSpaceLength: 5000
    },
    parameters: {
      postSpacing: 5000,
      purlinSpacing: 2500,
      railSpacing: 0,
      postProfile: 'IPE 300',      // Profils renforc√©s
      rafterProfile: 'IPE 240',
      purlinProfile: 'IPE 160',
      railProfile: 'UAP 80',
      steelGrade: 'S355',          // Acier haute r√©sistance
      includeGutters: false,
      includeDownspouts: false
    },
    solarArray: {
      panel: COMMON_SOLAR_PANELS['trina-600w'],  // Panneaux plus puissants
      orientation: 'landscape',
      rows: 5,
      columns: 40,
      rowSpacing: 100,
      columnSpacing: 50,
      tilt: 20,
      azimuth: 180,            // Plein sud
      antiReflectiveCoating: true,
      hailResistance: true
    },
    location: {
      latitude: 43.30,         // Marseille (Sud de la France)
      longitude: 5.40,
      altitude: 50
    },
    metadata: {
      author: 'Bureau d\'√©tudes XYZ',
      project: 'Centre Commercial M√©diterran√©e',
      notes: 'Ombri√®re parking ext√©rieur - Zone vent√©e'
    }
  });

  // Afficher r√©sultats d√©taill√©s
  console.log(`‚úÖ Ombri√®re cr√©√©e: ${ombriere.name}`);
  console.log('\nüìê DIMENSIONS:');
  console.log(`  - Longueur: ${ombriere.dimensions.length/1000}m`);
  console.log(`  - Largeur: ${ombriere.dimensions.width/1000}m`);
  console.log(`  - Hauteur libre: ${ombriere.dimensions.clearHeight/1000}m`);
  console.log(`  - Inclinaison panneaux: ${ombriere.dimensions.tilt}¬∞`);

  console.log('\nüöó PARKING:');
  console.log(`  - Nombre de places: ${ombriere.parkingLayout?.numberOfSpaces}`);
  console.log(`  - Surface parking: ${ombriere.parkingLayout?.totalArea.toFixed(0)} m¬≤`);

  console.log('\n‚òÄÔ∏è SYST√àME SOLAIRE:');
  console.log(`  - Nombre de panneaux: ${ombriere.structure.solarPanels.length}`);
  console.log(`  - Mod√®le: ${ombriere.solarArray.panel.manufacturer} ${ombriere.solarArray.panel.model}`);
  console.log(`  - Puissance unitaire: ${ombriere.solarArray.panel.power}Wc`);
  console.log(`  - Puissance totale: ${ombriere.electricalDesign.totalPower.toFixed(1)} kWc`);
  console.log(`  - Surface panneaux: ${(ombriere.structure.solarPanels.length * ombriere.solarArray.panel.width * ombriere.solarArray.panel.height / 1e6).toFixed(1)} m¬≤`);

  console.log('\n‚ö° √âLECTRIQUE:');
  console.log(`  - Nombre d\'onduleurs: ${ombriere.structure.inverters.length}`);
  console.log(`  - Puissance onduleurs: ${ombriere.structure.inverters[0]?.power}kW chacun`);
  console.log(`  - Syst√®me de terre: ${ombriere.electricalDesign.earthingSystem}`);

  console.log('\nüîã PERFORMANCE:');
  console.log(`  - Production annuelle: ${ombriere.performance?.annualProduction.toFixed(0)} kWh/an`);
  console.log(`  - Production sp√©cifique: ${ombriere.performance?.specificProduction.toFixed(0)} kWh/kWc/an`);
  console.log(`  - Performance Ratio: ${(ombriere.performance?.performanceRatio! * 100).toFixed(0)}%`);
  console.log(`  - √âconomie CO2: ${ombriere.performance?.carbonOffset.toFixed(1)} tonnes/an`);

  console.log('\nüèóÔ∏è STRUCTURE:');
  console.log(`  - Nombre de poteaux: ${ombriere.structure.posts.length}`);
  console.log(`  - Nombre de poutres: ${ombriere.structure.beams.length}`);
  console.log(`  - Nombre de pannes: ${ombriere.structure.purlins.length}`);
  console.log(`  - Contreventement: ${ombriere.structure.bracing.length} √©l√©ments`);

  const totalWeight =
    ombriere.structure.posts.reduce((sum, p) => sum + p.weight, 0) +
    ombriere.structure.beams.reduce((sum, b) => sum + b.weight, 0) +
    ombriere.structure.purlins.reduce((sum, p) => sum + p.weight, 0) +
    ombriere.structure.bracing.reduce((sum, b) => sum + b.weight, 0);
  console.log(`  - Poids acier total: ${totalWeight.toFixed(0)} kg`);

  const solarWeight = ombriere.structure.solarPanels.length * ombriere.solarArray.panel.weight;
  console.log(`  - Poids panneaux: ${solarWeight.toFixed(0)} kg`);
  console.log(`  - Poids total: ${(totalWeight + solarWeight).toFixed(0)} kg\n`);

  return ombriere;
}

/**
 * Exemple 3: Cr√©er une petite ombri√®re r√©sidentielle
 */
export function createResidentialOmbriere(): OmbriereBuilding {
  console.log('=== EXEMPLE 3: Petite ombri√®re r√©sidentielle ===\n');

  const ombriere = BuildingFactory.create<OmbriereBuilding>({
    name: 'Ombri√®re Maison Individuelle',
    type: BuildingType.OMBRIERE,
    dimensions: {
      length: 10000,         // 10m (2 places)
      width: 5000,           // 5m (1 rang√©e)
      clearHeight: 2300,     // 2.3m
      slope: 0,
      tilt: 15,              // 15¬∞
      numberOfParkingSpaces: 2,
      parkingSpaceWidth: 2500,
      parkingSpaceLength: 5000
    },
    solarArray: {
      panel: COMMON_SOLAR_PANELS['longi-540w'],
      orientation: 'landscape',
      rows: 2,
      columns: 4,
      rowSpacing: 100,
      columnSpacing: 50,
      tilt: 15,
      azimuth: 180,
      antiReflectiveCoating: true,
      hailResistance: true
    },
    location: {
      latitude: 48.85,       // Paris
      longitude: 2.35,
      altitude: 100
    }
  });

  console.log(`‚úÖ ${ombriere.name}`);
  console.log(`üöó Places: ${ombriere.parkingLayout?.numberOfSpaces}`);
  console.log(`‚òÄÔ∏è Panneaux: ${ombriere.structure.solarPanels.length}`);
  console.log(`‚ö° Puissance: ${ombriere.electricalDesign.totalPower.toFixed(1)} kWc`);
  console.log(`üîã Production: ${ombriere.performance?.annualProduction.toFixed(0)} kWh/an`);
  console.log(`üí° Autoconsommation estim√©e: 70-80%`);
  console.log(`üí∞ √âconomie annuelle: ~${(ombriere.performance?.annualProduction! * 0.7 * 0.20).toFixed(0)} ‚Ç¨/an\n`);

  return ombriere;
}

/**
 * Exemple 4: Comparer diff√©rentes configurations
 */
export function compareConfigurations(): void {
  console.log('=== EXEMPLE 4: Comparaison configurations ===\n');

  const configs = [
    { name: 'R√©sidentielle', tilt: 15, rows: 2, columns: 4 },
    { name: 'PME', tilt: 20, rows: 4, columns: 20 },
    { name: 'Industrielle', tilt: 25, rows: 10, columns: 40 }
  ];

  console.log('Configuration  | Places | Panneaux | Puissance | Production/an');
  console.log('---------------|--------|----------|-----------|---------------');

  configs.forEach(config => {
    const ombriere = BuildingFactory.create<OmbriereBuilding>({
      name: `Ombri√®re ${config.name}`,
      type: BuildingType.OMBRIERE,
      dimensions: {
        length: config.columns * 2500,
        width: config.rows * 5000,
        clearHeight: 2500,
        slope: 0,
        tilt: config.tilt,
        numberOfParkingSpaces: config.rows * config.columns / 2,
        parkingSpaceWidth: 2500,
        parkingSpaceLength: 5000
      },
      solarArray: {
        panel: COMMON_SOLAR_PANELS['longi-540w'],
        orientation: 'landscape',
        rows: config.rows,
        columns: config.columns,
        rowSpacing: 100,
        columnSpacing: 50,
        tilt: config.tilt,
        azimuth: 180,
        antiReflectiveCoating: true,
        hailResistance: true
      }
    });

    const places = ombriere.parkingLayout?.numberOfSpaces || 0;
    const panneaux = ombriere.structure.solarPanels.length;
    const puissance = ombriere.electricalDesign.totalPower.toFixed(0);
    const production = (ombriere.performance?.annualProduction! / 1000).toFixed(0);

    console.log(
      `${config.name.padEnd(14)} | ${String(places).padStart(6)} | ` +
      `${String(panneaux).padStart(8)} | ${String(puissance).padStart(7)}kWc | ` +
      `${String(production).padStart(10)}MWh`
    );
  });

  console.log('');
}

/**
 * Fonction principale pour ex√©cuter tous les exemples
 */
export function runAllExamples(): void {
  console.log('\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
  console.log('‚ïë   EXEMPLES OMBRI√àRE PHOTOVOLTA√èQUE - POC PHASE 1         ‚ïë');
  console.log('‚ïë   Architecture Extensible - Building Estimator            ‚ïë');
  console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n');

  try {
    // Exemple 1: Configuration par d√©faut
    createDefaultOmbriere();

    console.log('-----------------------------------------------------------\n');

    // Exemple 2: Configuration personnalis√©e
    createCustomOmbriere();

    console.log('-----------------------------------------------------------\n');

    // Exemple 3: R√©sidentiel
    createResidentialOmbriere();

    console.log('-----------------------------------------------------------\n');

    // Exemple 4: Comparaison
    compareConfigurations();

    console.log('‚úÖ Tous les exemples ex√©cut√©s avec succ√®s !');
    console.log('\nüí° La nouvelle architecture permet de cr√©er facilement');
    console.log('   de nouveaux types de structures sans modifier le code existant.\n');

  } catch (error) {
    console.error('‚ùå Erreur lors de l\'ex√©cution des exemples:', error);
    if (error instanceof Error) {
      console.error('Message:', error.message);
      console.error('Stack:', error.stack);
    }
  }
}

// Ex√©cuter les exemples si ce fichier est lanc√© directement
if (require.main === module) {
  runAllExamples();
}
